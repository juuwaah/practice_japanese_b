{% extends "base.html" %}

{% block title %}User Detail - {{ user.display_name }} - Japanese Learning App{% endblock %}

{% block window_title %}ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°: {{ user.display_name }}{% endblock %}

{% block content %}
<div style="text-align: center; margin-bottom: 16px;">
  <h1>ğŸ‘¤ {{ user.display_name }} ã®è©³ç´°</h1>
  <div style="margin-top: 8px;">
    <a href="{{ url_for('admin_users') }}" 
       style="font-size: 9px; text-decoration: underline; color: #000;">
      â† ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã«æˆ»ã‚‹
    </a>
  </div>
</div>

<!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼åŸºæœ¬æƒ…å ± -->
<div style="border: 2px solid #000; padding: 12px; margin-bottom: 16px; background: #FFFFFF;">
  <div style="font-size: 12px; font-weight: bold; margin-bottom: 8px;">åŸºæœ¬æƒ…å ±</div>
  <div style="font-size: 9px; line-height: 1.4;">
    <div><strong>ID:</strong> {{ user.id }}</div>
    <div><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼å:</strong> {{ user.username or 'æœªè¨­å®š' }}</div>
    <div><strong>ãƒ¡ãƒ¼ãƒ«:</strong> {{ user.email }}</div>
    <div><strong>ãƒ—ãƒ­ãƒã‚¤ãƒ€:</strong> {{ user.auth_type }}</div>
    <div><strong>ç™»éŒ²æ—¥:</strong> {{ user.created_at.strftime('%Y/%m/%d %H:%M') }}</div>
    <div><strong>æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³:</strong> {% if user.last_login %}{{ user.last_login.strftime('%Y/%m/%d %H:%M') }}{% else %}æœªãƒ­ã‚°ã‚¤ãƒ³{% endif %}</div>
    <div><strong>æ¨©é™:</strong> 
      {% if user.is_admin %}<span style="color: #FF0000;">ç®¡ç†è€…</span>
      {% elif user.is_patreon %}<span style="color: #FF6600;">Patreon</span>
      {% else %}<span style="color: #666;">ä¸€èˆ¬</span>
      {% endif %}
    </div>
    <div><strong>è¨€èªè¨­å®š:</strong> {{ user.language }}</div>
    <div><strong>ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š:</strong> {{ user.font_family }}</div>
  </div>
</div>

<!-- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼é€šçŸ¥ -->
<div style="border: 1px solid #FF6600; padding: 8px; margin-bottom: 16px; background: #FFF8F0;">
  <div style="font-size: 9px; color: #FF6600; font-weight: bold; margin-bottom: 4px;">ğŸ“‹ ç®¡ç†è€…ç”¨ãƒ­ã‚°é–²è¦§æ©Ÿèƒ½</div>
  <div style="font-size: 8px; color: #666; line-height: 1.3;">
    ã“ã®ãƒ­ã‚°ã¯ä»Šå¾Œã®ãƒ¬ãƒƒã‚¹ãƒ³ãƒ‡ã‚¶ã‚¤ãƒ³ã‚„æ©Ÿèƒ½æ”¹å–„ã®ãŸã‚ã«ã®ã¿ä½¿ç”¨ã•ã‚Œã€ç¬¬ä¸‰è€…ã«æä¾›ã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
  </div>
</div>

<!-- æ–‡æ³•ã‚¯ã‚¤ã‚ºãƒ­ã‚° -->
<div style="border: 2px solid #000; padding: 12px; margin-bottom: 16px; background: #FFFFFF;">
  <div style="font-size: 12px; font-weight: bold; margin-bottom: 8px;">ğŸ“ æ–‡æ³•ã‚¯ã‚¤ã‚ºãƒ­ã‚° (æœ€æ–°50ä»¶)</div>
  
  {% if grammar_logs %}
    <div style="overflow-x: auto;">
      <table style="width: 100%; border-collapse: collapse; font-size: 8px;">
        <thead>
          <tr style="background: #E0E0E0;">
            <th style="border: 1px solid #888; padding: 4px;">æ—¥æ™‚</th>
            <th style="border: 1px solid #888; padding: 4px;">ãƒ¬ãƒ™ãƒ«</th>
            <th style="border: 1px solid #888; padding: 4px;">æ–¹å‘</th>
            <th style="border: 1px solid #888; padding: 4px;">å…ƒæ–‡</th>
            <th style="border: 1px solid #888; padding: 4px;">ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ç­”</th>
            <th style="border: 1px solid #888; padding: 4px;">ã‚¹ã‚³ã‚¢</th>
          </tr>
        </thead>
        <tbody>
          {% for log in grammar_logs %}
          <tr>
            <td style="border: 1px solid #888; padding: 4px;">
              {{ log.created_at.strftime('%m/%d %H:%M') }}
            </td>
            <td style="border: 1px solid #888; padding: 4px; text-align: center;">{{ log.jlpt_level }}</td>
            <td style="border: 1px solid #888; padding: 4px; text-align: center;">
              {% if log.direction == 'ja_to_en' %}æ—¥â†’è‹±{% else %}è‹±â†’æ—¥{% endif %}
            </td>
            <td style="border: 1px solid #888; padding: 4px; max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
              {{ log.original_sentence[:100] }}{% if log.original_sentence|length > 100 %}...{% endif %}
            </td>
            <td style="border: 1px solid #888; padding: 4px; max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
              {{ log.user_translation[:100] }}{% if log.user_translation|length > 100 %}...{% endif %}
            </td>
            <td style="border: 1px solid #888; padding: 4px; text-align: center;">
              {% if log.score %}
                <span style="color: {% if log.score >= 80 %}#008000{% elif log.score >= 60 %}#FF8000{% else %}#FF0000{% endif %};">
                  {{ "%.0f"|format(log.score) }}%
                </span>
              {% else %}
                <span style="color: #666;">-</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div style="text-align: center; color: #808080; font-size: 9px; padding: 20px;">
      æ–‡æ³•ã‚¯ã‚¤ã‚ºã®ãƒ­ã‚°ã¯ã‚ã‚Šã¾ã›ã‚“
    </div>
  {% endif %}
</div>

<!-- ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ãƒ­ã‚° -->
<div style="border: 2px solid #000; padding: 12px; margin-bottom: 16px; background: #FFFFFF;">
  <div style="font-size: 12px; font-weight: bold; margin-bottom: 8px;">ğŸ“š ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ãƒ­ã‚° (æœ€æ–°50ä»¶)</div>
  
  {% if flashcard_logs %}
    <div style="overflow-x: auto;">
      <table style="width: 100%; border-collapse: collapse; font-size: 8px;">
        <thead>
          <tr style="background: #E0E0E0;">
            <th style="border: 1px solid #888; padding: 4px;">æ—¥æ™‚</th>
            <th style="border: 1px solid #888; padding: 4px;">ãƒ¬ãƒ™ãƒ«</th>
            <th style="border: 1px solid #888; padding: 4px;">å˜èª</th>
            <th style="border: 1px solid #888; padding: 4px;">æ„å‘³</th>
            <th style="border: 1px solid #888; padding: 4px;">çµæœ</th>
          </tr>
        </thead>
        <tbody>
          {% for log in flashcard_logs %}
          <tr>
            <td style="border: 1px solid #888; padding: 4px;">
              {{ log.created_at.strftime('%m/%d %H:%M') }}
            </td>
            <td style="border: 1px solid #888; padding: 4px; text-align: center;">{{ log.jlpt_level }}</td>
            <td style="border: 1px solid #888; padding: 4px;">
              {% if log.vocab %}{{ log.vocab.word }}{% else %}å‰Šé™¤æ¸ˆã¿å˜èª{% endif %}
            </td>
            <td style="border: 1px solid #888; padding: 4px;">
              {% if log.vocab %}{{ log.vocab.meaning }}{% else %}-{% endif %}
            </td>
            <td style="border: 1px solid #888; padding: 4px; text-align: center;">
              {% if log.result == 'learned' %}
                <span style="color: #008000;">âœ“ è¦šãˆãŸ</span>
              {% else %}
                <span style="color: #FF0000;">âœ— è¦šãˆã¦ã„ãªã„</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div style="text-align: center; color: #808080; font-size: 9px; padding: 20px;">
      ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ã®ãƒ­ã‚°ã¯ã‚ã‚Šã¾ã›ã‚“
    </div>
  {% endif %}
</div>

<!-- çµ±è¨ˆæƒ…å ± -->
<div style="border: 1px solid #000; padding: 8px; background: #F0F0F0; margin-top: 16px;">
  <div style="font-size: 9px; font-weight: bold; margin-bottom: 4px;">ğŸ“Š çµ±è¨ˆæƒ…å ±</div>
  <div style="font-size: 8px; line-height: 1.4;">
    <div><strong>æ–‡æ³•ã‚¯ã‚¤ã‚ºå›ç­”æ•°:</strong> {{ grammar_logs|length }}ä»¶</div>
    <div><strong>ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰å­¦ç¿’æ•°:</strong> {{ flashcard_logs|length }}ä»¶</div>
    <div><strong>ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æŠ•ç¨¿æ•°:</strong> {{ user.feedback|length }}ä»¶</div>
  </div>
</div>
{% endblock %}